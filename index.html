

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title></title>

    <meta charset="UTF-8">

    <script type="text/javascript" async="" src="./dc.js - Dimensional Charting Javascript Library_files/ga.js"></script><script type="text/javascript" src="./dc.js - Dimensional Charting Javascript Library_files/d3.v2.js"></script>
    <script type="text/javascript" src="./dc.js - Dimensional Charting Javascript Library_files/crossfilter.js"></script>

    <script type="text/javascript" src="./dc.js - Dimensional Charting Javascript Library_files/dc.js"></script>

    <link rel="stylesheet" type="text/css" href="./dc.js - Dimensional Charting Javascript Library_files/dc.css">
    <link rel="stylesheet" type="text/css" href="./dc.js - Dimensional Charting Javascript Library_files/example.css">

    <link href="./dc.js - Dimensional Charting Javascript Library_files/shCore.css" rel="stylesheet" type="text/css">
    <link href="./dc.js - Dimensional Charting Javascript Library_files/shThemeDefault.css" rel="stylesheet" type="text/css">
    <script src="./dc.js - Dimensional Charting Javascript Library_files/shCore.js" type="text/javascript"></script>
    <script src="./dc.js - Dimensional Charting Javascript Library_files/shAutoloader.js" type="text/javascript"></script>
    <script src="./dc.js - Dimensional Charting Javascript Library_files/shBrushJScript.js" type="text/javascript"></script>
    <script src="./dc.js - Dimensional Charting Javascript Library_files/shBrushXml.js" type="text/javascript"></script>

</head>
<body>

<div class="content">

<h1>SNP data visualization with histograms</h1>
<h2>IS1491_10_all_snps_exonic_variants_all_annotations</h2>
    <div id="g1000-score" class="dc-chart">
        <span class="title">1000Genome frequencies</span>
        <a class="reset" href="javascript:g1000ScoreBar.filterAll();dc.redrawAll();" style="">reset</a>
        <div class="clear"></div>
    </div>
    <div id="quality-score" class="dc-chart">
        <span class="title">Quality scores</span>
        <a class="reset" href="javascript:qualityScoreBar.filterAll();dc.redrawAll();" style="">reset</a>
        <div class="clear"></div>
    </div>
    <div id="sift-score" class="dc-chart">
        <span class="title">SIFT scores</span>
        <a class="reset" href="javascript:siftScoreBar.filterAll();dc.redrawAll();" style="">reset</a>
        <div class="clear"></div>
    </div>
<!--<div id="pp2-score" class="dc-chart">-->
    <!--<span class="title">PolyPhen2 scores</span>-->
    <!--<a class="reset" href="javascript:pp2ScoreBar.filterAll();dc.redrawAll();" style="">reset</a>-->
    <!--<div class="clear"></div>-->
<!--</div>-->
<div id="qbd-score" class="dc-chart">
    <span class="title">Quality By Depth scores</span>
    <a class="reset" href="javascript:qbdScoreBar.filterAll();dc.redrawAll();" style="">reset</a>
    <div class="clear"></div>
</div>
<div id="rrc-score" class="dc-chart">
    <span class="title">Reference Read Count</span>
    <a class="reset" href="javascript:rrcScoreBar.filterAll();dc.redrawAll();" style="">reset</a>
    <div class="clear"></div>
</div>

<div id="rms-score" class="dc-chart">
    <span class="title">RMS Mapping Quality</span>
    <a class="reset" href="javascript:rmsScoreBar.filterAll();dc.redrawAll();" style="">reset</a>
    <div class="clear"></div>
</div>

<div id="zygosity-type" class="dc-chart">
    <span class="title">Zygosity</span>
    <a class="reset" href="javascript:zygosityTypePie.filterAll();dc.redrawAll();" style="">reset</a>
    <div class="clear"></div>
</div>

<div id="overall" class="dc-chart">
    <span class="title">Overview (x:Chr, y:Avg.1KG Freq, size:# of SNPs, color: (Red(>50% Del.)/Green(<50% Del.)))</span>
    <!--<a href="#" class="purelycss_elegance_button color_deepblue hover_blue">Overview</a>-->
    <a class="reset" href="javascript:overallChart.filterAll();dc.redrawAll();" style="">reset</a>
    <div class="clear"></div>
</div>
<div id="variation-type" class="dc-chart">
    <span class="title">Types of SNPs</span>
    <a class="reset" href="javascript:variationTypePie.filterAll();dc.redrawAll();" style="">reset</a>
    <div class="clear"></div>
</div>
<div class="clear"></div>
<div >
    <div class="dc-data-count">
        <span class="filter-count"></span> selected out of <span class="total-count"></span> records | <a href="javascript:dc.filterAll(); dc.renderAll();">Reset All</a>
    </div>
</div>
    <!--<div id="chr-type" class="dc-chart">-->
        <!--<span class="title">Chromosomes</span>-->
        <!--<a class="reset" href="javascript:chromosomePie.filterAll();dc.redrawAll();" style="">reset</a>-->
        <!--<div class="clear"></div>-->
    <!--</div>-->

<div class="clear"></div>
<p></p>
<p></p>
<div >
    <table class="dc-data-table">
        <thead>
        <tr class="header">
            <td>Chr</td>
            <td>Gene</td>
            <td>Exon</td>
            <td>Start</td>
            <td>End</td>
            <td>Reference Allele</td>
            <td>Alternative Allele</td>
            <td>1KG Freq</td>
            <td>SIFT Score</td>
            <td>Zygosity</td>
        </tr>
        </thead>
    </table>
</div>

<script type="text/javascript">
var zygosityTypePie = dc.pieChart("#zygosity-type");
var variationTypePie = dc.pieChart("#variation-type");
//var chromosomePie = dc.pieChart("#chr-type");
var qualityScoreBar = dc.barChart("#quality-score");
//var pp2ScoreBar = dc.barChart("#pp2-score");
var qbdScoreBar = dc.barChart("#qbd-score");
var rrcScoreBar = dc.barChart("#rrc-score");
var rmsScoreBar = dc.barChart("#rms-score");
var siftScoreBar = dc.barChart("#sift-score");
var g1000ScoreBar = dc.barChart("#g1000-score");
var overallChart = dc.bubbleChart("#overall");
// set dc.js version in title
d3.selectAll("#version").text(dc.version);

// load data from a csv file
//var data=d3.csv("ga_noNA.csv");
d3.csv("ga_noNA.json", function(data) {

            var snps = crossfilter(data);
            var all = snps.groupAll();
            var barChartWidth=400;
            var barChartHeight=180;
            var pieChartWidth=256;
            var pieChartHeight=pieChartWidth;
            var pieChartRadius=120;
            var pieChartInnerRadius=45;
            var gapSize = 0.05;
            var zygosityType = snps.dimension(function(d) {
                return d.Zygosity;
            });
            var zygosityTypeGroup = zygosityType.group();
            zygosityTypePie.width(pieChartWidth)
                    .height(pieChartHeight)

                    .radius(pieChartRadius)
                    .innerRadius(pieChartInnerRadius)
                    .dimension(zygosityType)
                    .group(zygosityTypeGroup)
                    .label(function(d) {
                        return d.data.key + "(" + Math.floor(d.data.value / all.value() * 100) + "%)";
                    });

            var variationType = snps.dimension(function(d) {
                return d.variationclass;
            });
            var variationTypeGroup = variationType.
                    group().reduce(function(p,v){return 1;},function(p,v){return 1;},function(p,v){return 1;});
            variationTypePie.width(pieChartWidth)
                    .height(pieChartHeight)
                    .radius(pieChartRadius)
                    .innerRadius(pieChartInnerRadius)
//                    .colors(["#a60000","#ff0000", "#ff4040","#ff7373","#67e667","#39e639","#00cc00"])
//                    .colorDomain([1, 0])
                    .dimension(variationType)
                    .group(variationTypeGroup);
//                    .label(function(d) {
//                        return d.data.key + "(" + Math.floor(d.data.value / all.value() * 100) + "%)";
//                    });
            var chrType = snps.dimension(function(d) {
                return d.Chromosome;
            });
//            var chrTypeGroup = chrType.group().
//                    reduce(function(p,v){return 1;},function(p,v){return 1;},function(p,v){return 1;});

            var chrCols=['#1f77b4', '#aec7e8', '#ff7f0e', '#ffbb78', '#2ca02c',
                '#98df8a', '#d62728', '#ff9896', '#9467bd', '#c5b0d5', '#8c564b', '#c49c94',
            '#e377c2', '#f7b6d2', '#7f7f7f', '#c7c7c7', '#bcbd22', '#dbdb8d', '#17becf', '#9edae5',
                    '#e6550d', '#fd8d3c', '#fdae6b', '#fdd0a2', '#31a354', '#74c476'];
//            chromosomePie.width(pieChartWidth)
//                    .height(pieChartHeight)
//                    .radius(pieChartRadius)
//                    .innerRadius(pieChartInnerRadius)
//                    .colors(chrCols)
//                    .dimension(chrType)
//                    .group(chrTypeGroup);
//                    .label(function(d) {
//                        return d.data.key + "(" + Math.floor(d.data.value / all.value() * 100) + "%)";
//                    });
            var overallType = snps.dimension(function(d) {
                return d.Chromosome;
            });
            var chrScale=d3.scale.ordinal().
                    domain(["chr1","chr2",
                "chr3","chr4","chr5","chr6","chr7","chr8","chr9","chr10","chr11",
                "chr12","chr13","chr14","chr15","chr16","chr17","chr18","chr19","chr20","chr21","chr22","chrX","chrY"]).
                    rangePoints([1,25]);
            var revChrScale=d3.scale.ordinal().domain([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25])
                    .range(["chr1","chr2",
                "chr3","chr4","chr5","chr6","chr7","chr8","chr9","chr10","chr11",
                "chr12","chr13","chr14","chr15","chr16","chr17","chr18","chr19","chr20","chr21","chr22","chrX","chrY"]);


//                    rangePoints([1,2]);
            console.log(chrScale("chr12"));
            var overallGroup = overallType.group().reduce(
                    //add
                    function(p, v) {
                        ++p.count;
                        p.cntDSIFT += ( +v.sift < 0.05 )? 1:0;
                        p.percentDSIFT = p.cntDSIFT / p.count;
                        p.sumg1000 += +v.g1000;
                        p.avgg1000 = p.sumg1000 / p.count;
                        p.chID = chrScale(v.Chromosome);
                        p.sumQS += +v.qs;
                        p.avgQS = p.sumQS / p.count;
                        return p;
                    },
                    //remove
                    function(p, v) {
                        --p.count;
                        p.cntDSIFT -= ( +v.sift < 0.05 )? 1:0;
                        p.percentDSIFT = p.cntDSIFT / p.count;
                        p.sumg1000 -= +v.g1000;
                        p.avgg1000 = p.sumg1000 / p.count;
                        p.chID = chrScale(v.Chromosome);
                        p.sumQS -= +v.qs;
                        p.avgQS = p.sumQS / p.count;
                        return p;
                    },
                    //init
                    function() {
                        return {chID:0,count:0, avgSIFT:0, sumSIFT:0, sumg1000:0, avgg1000:0,sumQS:0,avgQS:0,cntDSIFT:0,percentDSIFT:0};
                    }
            );
            console.log(overallGroup.top(1)[0].key+ "'s count is: "+(overallGroup.top(1)[0]).value);
            var g1000format=d3.format(".2f");
            overallChart.width(barChartWidth*1.65)
                    .height(barChartHeight*1.5)
                    .margins({top: 10, right: 50, bottom: 30, left: 80})
                    .dimension(overallType)
                    .group(overallGroup)
                    .transitionDuration(1500)
                    .colors(["#a60000","#ff0000", "#ff4040","#ff7373","#67e667","#39e639","#00cc00"])
                    .colorDomain([1, 0])
                    .colorAccessor(function(p){
                        return p.value.percentDSIFT;
                    })
                    .keyAccessor(function(p) {
                        return p.value.chID;
                    })
                    .valueAccessor(function(p) {
                        return p.value.avgg1000;
                    })
                    .radiusValueAccessor(function(p) {
                        return p.value.count;
                    })
                    .maxBubbleRelativeSize(0.13)
//                    .x(chrScale)
                    .x(d3.scale.linear().domain([1,25]))
                    .y(d3.scale.linear().domain([0, 1]))
                    .r(d3.scale.linear().domain([0, 4000]))
                    .elasticY(false)
                    .yAxisPadding(100)
                    .elasticX(false)
//                    .xAxisPadding(500)
                    .renderHorizontalGridLines(true)
                    .renderVerticalGridLines(false)
                    .renderLabel(true)
                    .label(function(p) {
                        return g1000format(p.value.avgg1000);
                    })
                    .renderTitle(false)
                    .title(function(p) {
                        return "" + p.key + "\n"
                                + "SNP Count: " + p.value.count+ "\n"
                                + "Avg. 1KGenome Freq: " + g1000format(p.value.avgg1000) + "\n"
                                + "Avg. Quality Score: " + g1000format(p.value.avgQS) + "\n"
                                + "Deleterious SIFT Percentage: " + g1000format(p.value.percentDSIFT)*100 + "%\n"
                                ;

                    })
                    .xAxis().tickFormat(function(p) {
                        return "chr"+p;
                    });
            var qualityScoreMax = d3.max(data,function(d){
               return +d.qs;
            });
            console.log(qualityScoreMax);
            var pp2range = [];
            for (var i=1; i < 100; i++) pp2range.push(i);
//            for(var i=1; i < 100; i = i + 5) pp2range.push(i);
            var qualityScoreScale =d3.scale.quantize().domain([0,qualityScoreMax]).range(pp2range);
            var qualityScoreType = snps.dimension(function(d) {
//                return d3.round((+d.qs/qualityScoreMax),2)*100;
            return qualityScoreScale(+d.qs);
//                return +d.qs;
            });
            var qualityScoreTypeGroup = qualityScoreType.group();
            qualityScoreBar.
            width(barChartWidth)
                    .height(barChartHeight)
                    .margins({top: 10, right: 50, bottom: 30, left: 40})
                    .dimension(qualityScoreType)
                    .group(qualityScoreTypeGroup)
                    .elasticY(true)
                    .elasticX(true)
                    .centerBar(false)
                    .gap(gapSize)
                    .x(d3.scale.linear())
//                    .x(d3.scale.quantize().domain([0, qualityScoreMax]).range(pp2range))
//                    .y(d3.scale.linear().domain([0, 1000]))
                    .renderHorizontalGridLines(true)
                    .xAxis();
            var qbdScoreMax = d3.max(data,function(d){
                return +d.qbd;
            });
            console.log(qbdScoreMax);

            var qbdScoreScale =d3.scale.quantize().domain([0,qbdScoreMax]).range(pp2range);
            var qbdScoreType = snps.dimension(function(d) {
//                return d3.round((+d.qs/qualityScoreMax),2)*100;
                return qbdScoreScale(+d.qbd)
            });
            var qbdScoreTypeGroup = qbdScoreType.group();
            qbdScoreBar.
                    width(barChartWidth)
                    .height(barChartHeight)
                    .margins({top: 10, right: 50, bottom: 30, left: 40})
                    .dimension(qbdScoreType)
                    .group(qbdScoreTypeGroup)
                    .elasticY(true)
                    .elasticX(true)
                    .centerBar(false)
                    .gap(gapSize)
                    .x(d3.scale.linear().domain([0, 1.1]))
//                    .y(d3.scale.linear().domain([0, 1000]))
                    .renderHorizontalGridLines(true)
                    .xAxis();
            var rrcScoreMax = d3.max(data,function(d){
                return +d.rrc;
            });
            console.log(rrcScoreMax);

            var rrcScoreScale =d3.scale.quantize().domain([0,rrcScoreMax]).range(pp2range);
            var rrcScoreType = snps.dimension(function(d) {
//                return d3.round((+d.qs/qualityScoreMax),2)*100;
                return rrcScoreScale(+d.rrc)
            });
            var rrcScoreTypeGroup = rrcScoreType.group();
            rrcScoreBar.
                    width(barChartWidth)
                    .height(barChartHeight)
                    .margins({top: 10, right: 50, bottom: 30, left: 40})
                    .dimension(rrcScoreType)
                    .group(rrcScoreTypeGroup)
                    .elasticY(true)
                    .elasticX(true)
                    .centerBar(false)
                    .gap(gapSize)
                    .x(d3.scale.linear().domain([0, 1.1]))
//                    .y(d3.scale.linear().domain([0, 1000]))
                    .renderHorizontalGridLines(true)
                    .xAxis();
            var rmsScoreMax = d3.max(data,function(d){
                return +d.rms;
            });
            console.log(rmsScoreMax);

            var rmsScoreScale =d3.scale.quantize().domain([0,rmsScoreMax]).range(pp2range);
            var rmsScoreType = snps.dimension(function(d) {
//                return d3.round((+d.qs/qualityScoreMax),2)*100;
                return rmsScoreScale(+d.rms)
            });
            var rmsScoreTypeGroup = rmsScoreType.group();
            rmsScoreBar.
                    width(barChartWidth)
                    .height(barChartHeight)
                    .margins({top: 10, right: 50, bottom: 30, left: 40})
                    .dimension(rmsScoreType)
                    .group(rmsScoreTypeGroup)
                    .elasticY(true)
                    .elasticX(true)
                    .centerBar(false)
                    .gap(gapSize)
                    .x(d3.scale.linear().domain([0, 1.1]))
//                    .y(d3.scale.linear().domain([0, 1000]))
                    .renderHorizontalGridLines(true)
                    .xAxis();
            console.log(qualityScoreMax);
//            var pp2ScoreMin = d3.min(data,function(d){
//                return +d.pp2;
//            }) + 0.00000001;

            var pp2Scale = d3.scale.quantize().domain([0,1]).range(pp2range);
//            var pp2ScoreType = snps.dimension(function(d) {
//                return pp2Scale(+d.pp2);
//            });
//
//            var pp2ScoreTypeGroup = pp2ScoreType.group();
//            var pp2ScoreTypeGroupMax = pp2ScoreTypeGroup.top(1);
//            console.log(pp2ScoreTypeGroupMax[0].value);
//            pp2ScoreBar.
//                    width(barChartWidth)
//                    .height(barChartHeight)
//                    .margins({top: 10, right: 50, bottom: 30, left: 40})
//                    .dimension(pp2ScoreType)
//                    .group(pp2ScoreTypeGroup)
//                    .elasticY(true)
//                    .elasticX(true)
//                    .centerBar(false)
//                    .gap(1)
////                    .x(d3.scale.linear().domain([0, 100]).range([1,100]))
//                    .x(d3.scale.linear().domain([100,200]).range([0,200]))
////                    .y(d3.scale.linear().domain([0, pp2ScoreTypeGroupMax]))
//                    .renderHorizontalGridLines(true);
////                    .xAxis();

            var siftScoreType = snps.dimension(function(d) {
//                return +d.sift*100;
                return pp2Scale(+d.sift);
            });

            var siftTypeGroup = siftScoreType.group();
            siftScoreBar.
                    width(barChartWidth)
                    .height(barChartHeight)
                    .margins({top: 10, right: 50, bottom: 30, left: 40})
                    .dimension(siftScoreType)
                    .group(siftTypeGroup)
                    .elasticY(true)
                    .elasticX(true)
                    .centerBar(false)
                    .gap(gapSize)
                    .x(d3.scale.linear().domain([0, 1.1]))
//                    .y(d3.scale.linear().domain([0,1000]))
                    .renderHorizontalGridLines(true)
                    .xAxis();
            var g1000ScoreMin = d3.min(data,function(d){
                return +d.g1000;
            });
            var g1000ScoreType = snps.dimension(function(d) {
//                return Math.round(+d.g1000/g1000ScoreMin);
                return pp2Scale(+d.g1000);
            });
            var g1000ScoreTypeGroup = g1000ScoreType.group();
            g1000ScoreBar.
                    width(barChartWidth)
                    .height(barChartHeight)
                    .margins({top: 10, right: 50, bottom: 30, left: 40})
                    .dimension(g1000ScoreType)
                    .group(g1000ScoreTypeGroup)
                    .elasticY(true)
                    .elasticX(true)
                    .centerBar(false)
                    .gap(gapSize)
                    .x(d3.scale.linear().domain([0, 1.1]))
                    .renderHorizontalGridLines(true)
                    .xAxis();


            dc.dataCount(".dc-data-count")
                    .dimension(snps)
                    .group(all);

            var dataTableType = snps.dimension(function(d) {
//                return +d.sift*100;
                return d.Chromosome;
            });
            dc.dataTable(".dc-data-table")
                    .dimension(dataTableType)
                    .group(function(d) {
                        return d.Chromosome;
                    })
                    .size(1000)//todo: the size must >= the actual size, otherwise it will do random sampling.
                    .columns([
                function(d) {
                    return d.Chromosome;
                },
                function(d) {
                    return d.Gene;
                },
                function(d) {
                    return d.Exon;
                },
                function(d) {
                    return d.start;
                },
                function(d) {
                    return d.end;
                },
                function(d) {
                    return d.ra;
                },
                function(d) {
                    return d.aa;
                },
                function(d) {
                    return +d.g1000;
                },
                function(d) {
                    return d.sift;
                },
                function(d) {
                    return d.Zygosity;
                }
            ])
                    .sortBy(function(d) {
                        return +d.g1000;
                    })
                    .order(d3.ascending);
            dc.renderAll();
        }
);
</script>
    </div>
</body></html>
